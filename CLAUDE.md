# CLAUDE.md

- 开发过程中，如果需要执行git相关操作，请必须使用github这个mcp工具进行提交和推送操作，而不是使用bash执行常规的git命令

## 项目概述

这是一个完整的网页数独游戏，具有完整的游戏功能和用户交互体验。

## 技术架构

- **前端技术栈**: HTML5 + CSS3 + JavaScript (ES6+)
- **布局方式**: CSS Grid用于数独棋盘布局
- **数据存储**: LocalStorage用于游戏状态持久化
- **编程模式**: 事件驱动编程，面向对象设计

## 项目结构

```
soduku/
├── index.html          # 主页面，包含游戏界面结构
├── css/
│   └── style.css       # 完整的样式定义，包含响应式设计
├── js/
│   ├── game.js         # 核心游戏逻辑类SudokuGame
│   ├── ui.js           # 用户界面交互类SudokuUI
│   └── utils.js        # 工具函数集合
└── data/
    └── puzzles.js      # 数独题目数据和生成算法
```

## 核心功能

### 1. 基础游戏功能
- 标准9×9数独棋盘
- 三种难度级别（简单、中等、困难）
- 数字输入和删除
- 游戏完成检测
- 计时器和步数统计

### 2. 辅助功能
- **候选数管理**: 3×3网格固定位置显示候选数
- **智能候选数**: 自动排除已有数字的候选数
- **一键填入**: 一键填入所有候选数
- **唯一候选数**: 自动填写只有一个候选数的格子
- **错误检查**: 实时检测和显示冲突错误

### 3. 高亮系统
- **相同数字高亮**: 点击任意格子高亮所有相同数字
- **关联格子高亮**: 不同颜色高亮同行、同列、同宫格
- **候选数高亮**: 高亮包含特定候选数的格子
- **选中状态**: 清晰的选中格子标识

### 4. 交互方式
- **鼠标操作**: 点击选择格子，点击按钮输入数字
- **键盘控制**:
  - 数字键1-9输入数字
  - 方向键移动选中格子
  - Delete/Backspace删除数字
  - 空格键临时切换候选数模式
  - Ctrl+Z撤销操作
  - Ctrl+N开始新游戏

### 5. 数据持久化
- **自动保存**: 页面关闭前自动保存游戏状态
- **游戏恢复**: 页面加载时自动恢复未完成的游戏
- **设置保存**: 保存难度设置和用户偏好

## 关键特性

### 候选数系统
- 候选数按照3×3网格固定位置显示（1在左上，5在中间，9在右下）
- 输入数字时自动删除相关格子的对应候选数
- 智能计算，只显示有效的候选数

### 用户体验优化
- 流畅的动画过渡效果
- 清晰的视觉反馈
- 直观的操作方式
- 响应式设计适配不同屏幕

### 错误处理
- 实时冲突检测
- 错误格子高亮显示
- 防止输入无效数字

## 开发说明

### 类设计
- **SudokuGame类**: 核心游戏逻辑，包含棋盘管理、规则验证、游戏状态
- **SudokuUI类**: 用户界面管理，包含事件处理、UI更新、用户交互
- **Storage对象**: 本地存储工具，处理游戏状态和设置的保存/加载

### 算法实现
- **候选数计算**: isValidMoveForGame()函数检查行、列、宫格冲突
- **冲突检测**: findConflicts()函数找出所有冲突位置
- **关联格子**: getRelatedCells()函数获取同行、同列、同宫格格子
- **唯一候选数**: 递归算法自动填写只有一个候选数的格子

### 事件处理
- 统一的事件监听器管理
- 键盘和鼠标事件的完整支持
- 防抖和节流优化性能

## 已知问题解决方案

1. **候选数位置问题**: 确保3×3网格的正确映射关系
2. **高亮逻辑**: 实现多层次的视觉高亮系统
3. **游戏状态清理**: 加载游戏时清除候选数确保干净开始
4. **临时模式切换**: 空格键按下进入候选数模式，松开恢复数字模式