# CLAUDE.md

- 开发过程中，如果需要执行git相关操作，请必须使用github这个mcp工具进行提交和推送操作，而不是使用bash执行常规的git命令
- GitHub仓库信息: owner用户名为Nicolas-is-nic

## 项目概述

这是一个基于Web的数独游戏，采用现代前端技术栈开发，具有完整的游戏功能和优秀的用户交互体验。项目使用纯前端技术实现，无需后端服务器，可直接在浏览器中运行。

## 技术架构

- **前端技术栈**: HTML5 + CSS3 + JavaScript (ES6+)
- **布局方式**: CSS Grid用于数独棋盘布局，Flexbox用于界面布局
- **数据存储**: LocalStorage用于游戏状态持久化
- **编程模式**: 事件驱动编程，面向对象设计
- **响应式设计**: 适配不同屏幕尺寸

## 项目结构

```
soduku/
├── index.html          # 主页面，包含游戏界面结构
├── css/
│   └── style.css       # 完整的样式定义，包含响应式设计和动画效果
├── js/
│   ├── game.js         # 核心游戏逻辑类SudokuGame (457行)
│   ├── ui.js           # 用户界面交互类SudokuUI (404行)
│   └── utils.js        # 工具函数集合 (229行)
└── data/
    └── puzzles.js      # 数独题目数据和生成算法 (202行)
```

## 核心功能

### 1. 基础游戏功能
- 标准9×9数独棋盘，采用CSS Grid布局
- 三种难度级别（简单、中等、困难）
- 数字输入和删除功能
- 游戏完成检测和胜利提示
- 实时计时器和步数统计
- 新游戏生成功能

### 2. 候选数系统
- **候选数显示**: 3×3网格固定位置显示候选数
- **智能候选数**: 自动计算和显示有效的候选数
- **一键填入**: 一键填入所有可能的候选数
- **唯一候选数**: 自动填写只有一个候选数的格子（递归实现）
- **候选数管理**: 输入数字时自动删除相关格子的对应候选数

### 3. 高亮系统
- **相同数字高亮**: 点击格子高亮所有相同数字
- **关联格子高亮**: 多层次高亮同行、同列、同宫格
- **候选数高亮**: 高亮包含特定候选数的格子
- **选中状态**: 清晰的选中格子标识和动画效果

### 4. 交互方式
- **鼠标操作**: 点击选择格子，点击按钮输入数字
- **键盘控制**:
  - 数字键1-9: 输入数字
  - 方向键: 移动选中格子
  - Delete/Backspace: 删除数字
  - 空格键: 临时切换候选数模式（按下进入，松开退出）
  - Ctrl+Z: 撤销操作
  - Ctrl+N: 开始新游戏

### 5. 数据持久化
- **自动保存**: 页面关闭前自动保存游戏状态
- **游戏恢复**: 页面加载时自动恢复未完成的游戏
- **设置保存**: 保存难度设置和用户偏好
- **历史记录**: 支持最多50步撤销操作

## 关键特性

### 候选数系统实现
- 候选数按照3×3网格固定位置显示（1在左上，5在中间，9在右下）
- 使用CSS Grid实现候选数的精确定位
- 智能候选数计算，只显示有效的候选数
- 候选数与数字输入的智能联动

### 用户体验优化
- 流畅的CSS动画过渡效果
- 清晰的视觉反馈和状态提示
- 直观的操作方式和学习曲线
- 响应式设计适配桌面和移动设备
- 渐变背景和现代化UI设计

### 错误处理和验证
- 实时冲突检测和显示
- 错误格子红色高亮显示
- 防止输入无效数字和修改固定格子
- 游戏完成验证

## 开发说明

### 核心类设计

#### SudokuGame类 (js/game.js)
- **属性**: board（游戏板）、solution（解答）、selectedCell（选中格子）、history（历史记录）
- **方法**:
  - 游戏控制: startNewGame(), loadPuzzle(), selectCell()
  - 数值操作: enterNumber(), setCellValue(), clearCell()
  - 候选数管理: toggleNote(), fillAllNotes(), fillUniqueCandidates()
  - 游戏状态: checkCompletion(), findConflicts(), undo()

#### SudokuUI类 (js/ui.js)
- **属性**: game（游戏实例）、boardElement（棋盘元素）
- **方法**:
  - UI管理: initializeBoard(), updateUI(), updateBoard()
  - 事件处理: attachEventListeners(), handleKeyPress()
  - 高亮系统: highlightRelatedCells(), getCellElement()
  - 模态框: showVictoryModal(), hideVictoryModal()

#### Storage对象 (js/utils.js)
- **游戏状态**: saveGame(), loadGame(), clearGame()
- **设置管理**: saveSettings(), loadSettings()
- **错误处理**: 包含完整的异常捕获和处理

### 算法实现

#### 候选数计算算法
```javascript
function calculateCandidates(board, row, col) {
    // 检查1-9每个数字是否可以填入指定位置
    // 考虑行、列、宫格的冲突检测
}
```

#### 冲突检测算法
```javascript
function findConflicts(board, row, col, num) {
    // 查找指定数字在行、列、宫格中的所有冲突位置
    // 返回冲突格子坐标数组
}
```

#### 唯一候选数算法
- 递归实现自动填写只有一个候选数的格子
- 填写一个格子后重新计算，链式反应

#### 关联格子计算
```javascript
function getRelatedCells(row, col) {
    // 计算指定格子的同行、同列、同宫格的所有格子
    // 返回分类后的关联格子集合
}
```

### 事件处理架构
- **统一事件监听**: 使用事件委托提高性能
- **键盘事件**: 完整的键盘快捷键支持
- **鼠标事件**: 点击、悬停等交互
- **生命周期事件**: 页面加载、关闭前的数据保存

### 性能优化
- **防抖和节流**: utils.js中提供debounce()和throttle()函数
- **DOM操作优化**: 批量更新UI，减少重排重绘
- **内存管理**: 历史记录限制，避免内存泄漏

## 样式设计

### CSS Grid布局
- 9×9游戏板使用CSS Grid精确布局
- 3×3宫格使用边框分隔
- 候选数使用嵌套Grid实现精确定位

### 视觉效果
- **颜色主题**: 蓝紫渐变背景，白色卡片设计
- **状态颜色**: 选中（蓝色）、高亮（黄色）、错误（红色）
- **动画效果**: hover效果、点击动画、模态框过渡
- **响应式**: 使用flexbox和媒体查询适配不同屏幕

## 注意事项

### 已知问题和解决方案
1. **候选数位置映射**: 确保3×3网格的正确映射关系，数字1-9按照固定位置显示
2. **游戏状态清理**: 加载游戏时清除候选数确保干净开始
3. **临时模式切换**: 空格键按下进入候选数模式，松开自动恢复数字模式
4. **历史记录管理**: 限制历史记录数量避免内存问题
5. **数据持久化**: LocalStorage的异常处理和兼容性

### 浏览器兼容性
- 支持现代浏览器（Chrome、Firefox、Safari、Edge）
- 使用ES6+语法，需要浏览器支持
- CSS Grid支持性良好

### 性能考虑
- 大量DOM操作时使用文档片段优化
- 事件监听器合理使用委托
- 定时器及时清理避免内存泄漏
